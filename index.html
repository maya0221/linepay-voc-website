<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE Pay VOC Insights Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .line-green { color: #00B900; }
        /* Error Container Style */
        #error-container { display: none; padding: 20px; background: #fee2e2; color: #991b1b; border: 1px solid #f87171; margin: 20px; border-radius: 8px; font-weight: bold; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "xlsx": "https://esm.sh/xlsx@0.18.5",
        "recharts": "https://esm.sh/recharts@2.12.0?external=react,react-dom",
        "html2canvas": "https://esm.sh/html2canvas@1.4.1"
      }
    }
    </script>
</head>
<body>
    <div id="error-container"></div>
    <div id="root"></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const container = document.getElementById('error-container');
            container.style.display = 'block';
            container.innerHTML = `<h3>üö® Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</h3><p>${message}</p><p>ÏúÑÏπò: ${source} (Ï§Ñ: ${lineno})</p>`;
        };
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            Download, Copy, ChevronLeft, ChevronRight, ExternalLink, MessageSquare, 
            BarChart2, PieChart, Globe, Smile, Meh, Frown, Filter, TrendingUp, Search, 
            LayoutGrid, Mail 
        } from 'lucide-react';
        import { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell 
        } from 'recharts';
        import * as XLSX from 'xlsx';
        import html2canvas from 'html2canvas';

        // --- Mock Data ---
        const CATEGORIES = ['Payment UX', 'Merchant Network', 'Promotion', 'Account Setup', 'CS Response'];
        const SOURCES = ['Facebook', 'Threads', 'App Store', 'Play Store'];
        const COUNTRIES = ['TW', 'TH', 'JP', 'Global'];
        const SENTIMENTS = ['Positive', 'Neutral', 'Negative'];

        const generateMockData = () => {
            return Array.from({ length: 150 }).map((_, i) => {
                const country = COUNTRIES[i % COUNTRIES.length];
                const source = SOURCES[i % SOURCES.length];
                const sentiment = SENTIMENTS[Math.floor(Math.random() * SENTIMENTS.length)];
                const category = CATEGORIES[i % CATEGORIES.length];
                const day = (i % 28) + 1;
                const date = `2024-03-${day.toString().padStart(2, '0')}`;
                
                return {
                    id: `voc-${i}`,
                    source, date, country, sentiment, category,
                    originalContent: `[${category}] Experience with LINE Pay in ${country}. The ${category.toLowerCase()} service was ${sentiment === 'Positive' ? 'outstanding' : sentiment === 'Negative' ? 'quite slow' : 'average'}.`,
                    koreanTranslation: `[${category}] ${country} ÏßÄÏó≠ LINE Pay Ïù¥Ïö© ÌõÑÍ∏∞ÏûÖÎãàÎã§. ${category} ÏÑúÎπÑÏä§Í∞Ä ${sentiment === 'Positive' ? 'Îß§Ïö∞ ÌõåÎ•≠ÌñàÏäµÎãàÎã§' : sentiment === 'Negative' ? 'Îã§ÏÜå ÎäêÎ¶¨Í≥† Î∂àÌé∏ÌñàÏäµÎãàÎã§' : 'Î≥¥ÌÜµÏù¥ÏóàÏäµÎãàÎã§'}.`,
                    link: `https://linepay.example.com/voc/${i}`
                };
            });
        };

        const MOCK_DATA = generateMockData();

        // --- Main App ---
        const App = () => {
            const dashboardRef = useRef(null);
            const [dateRange, setDateRange] = useState({ start: '2024-03-01', end: '2024-03-31' });
            const [countryPicker, setCountryPicker] = useState('All');
            const [sentimentPicker, setSentimentPicker] = useState('All');
            
            const [appliedFilters, setAppliedFilters] = useState({
                start: '2024-03-01', end: '2024-03-31', country: 'All', sentiment: 'All'
            });

            const [currentPage, setCurrentPage] = useState(1);
            const [isCopied, setIsCopied] = useState(false);
            const [isImageCopying, setIsImageCopying] = useState(false);
            const itemsPerPage = 15;

            const handleSearch = () => {
                setAppliedFilters({ start: dateRange.start, end: dateRange.end, country: countryPicker, sentiment: sentimentPicker });
                setCurrentPage(1); 
            };

            const filteredData = useMemo(() => {
                return MOCK_DATA.filter(item => {
                    const withinDate = item.date >= appliedFilters.start && item.date <= appliedFilters.end;
                    const countryMatch = appliedFilters.country === 'All' || item.country === appliedFilters.country;
                    const sentimentMatch = appliedFilters.sentiment === 'All' || item.sentiment === appliedFilters.sentiment;
                    return withinDate && countryMatch && sentimentMatch;
                }).sort((a, b) => b.date.localeCompare(a.date));
            }, [appliedFilters]);

            const sentimentStats = useMemo(() => {
                const counts = { Positive: 0, Neutral: 0, Negative: 0 };
                filteredData.forEach(item => counts[item.sentiment]++);
                return [
                    { name: 'Positive', count: counts.Positive, color: '#00B900' },
                    { name: 'Neutral', count: counts.Neutral, color: '#94a3b8' },
                    { name: 'Negative', count: counts.Negative, color: '#ef4444' },
                ];
            }, [filteredData]);

             const sourceTableData = useMemo(() => {
                const table = {};
                SOURCES.forEach(s => table[s] = { pos: 0, neu: 0, neg: 0 });
                filteredData.forEach(item => {
                    const key = item.sentiment === 'Positive' ? 'pos' : item.sentiment === 'Negative' ? 'neg' : 'neu';
                    if(table[item.source]) table[item.source][key]++;
                });
                return Object.entries(table).map(([name, val]) => ({ name, ...val, total: val.pos + val.neu + val.neg }));
            }, [filteredData]);

            const categoryTableData = useMemo(() => {
                const table = {};
                CATEGORIES.forEach(cat => table[cat] = { pos: 0, neu: 0, neg: 0 });
                filteredData.forEach(item => {
                    if (table[item.category]) {
                        const key = item.sentiment === 'Positive' ? 'pos' : item.sentiment === 'Negative' ? 'neg' : 'neu';
                        table[item.category][key]++;
                    }
                });
                return Object.entries(table).map(([name, val]) => ({ name, ...val, total: val.pos + val.neu + val.neg })).sort((a, b) => b.total - a.total);
            }, [filteredData]);

            const downloadExcel = () => {
                const wsData = filteredData.map(i => ({
                    Source: i.source, Date: i.date, Country: i.country, Sentiment: i.sentiment, Category: i.category,
                    'Original Content': i.originalContent, 'Korean Translation': i.koreanTranslation, Link: i.link
                }));
                const ws = XLSX.utils.json_to_sheet(wsData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "VOC_Data");
                XLSX.writeFile(wb, `LINE_Pay_VOC_Report.xlsx`);
            };

            const copyToConfluence = () => {
                let html = `<table border="1"><thead><tr><th>Source</th><th>Date</th><th>Country</th><th>Sentiment</th><th>Category</th><th>Content</th><th>Translation</th></tr></thead><tbody>`;
                filteredData.slice(0, 50).forEach(i => {
                    html += `<tr><td>${i.source}</td><td>${i.date}</td><td>${i.country}</td><td>${i.sentiment}</td><td>${i.category}</td><td>${i.originalContent}</td><td>${i.koreanTranslation}</td></tr>`;
                });
                html += `</tbody></table>`;
                const blob = new Blob([html], { type: 'text/html' });
                const item = new ClipboardItem({ 'text/html': blob });
                navigator.clipboard.write([item]).then(() => {
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                });
            };

            const copyReportAsImage = async () => {
                if (!dashboardRef.current) return;
                setIsImageCopying(true);
                try {
                    const canvas = await html2canvas(dashboardRef.current, { backgroundColor: '#f8fafc', scale: 2 });
                    canvas.toBlob(async (blob) => {
                        if (blob) {
                            await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                            alert("Copied as Image!");
                        }
                    });
                } catch (err) { console.error(err); } 
                finally { setIsImageCopying(false); }
            };

            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const paginatedData = filteredData.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="h-16 bg-white border-b border-slate-200 sticky top-0 z-50 px-6 flex items-center justify-between shadow-sm">
                        <div className="flex items-center gap-3">
                            <div className="w-9 h-9 bg-[#00B900] rounded-xl flex items-center justify-center shadow-lg"><TrendingUp className="text-white w-5 h-5" /></div>
                            <h1 className="text-xl font-black text-slate-900 uppercase">LINE Pay VOC Intelligence</h1>
                        </div>
                        <div className="flex items-center gap-2">
                            <button onClick={downloadExcel} className="flex items-center gap-1.5 px-4 py-2 bg-blue-600 text-white rounded-lg text-xs font-black hover:bg-blue-700"><Download size={14} /> Excel</button>
                            <button onClick={copyToConfluence} className="flex items-center gap-1.5 px-4 py-2 bg-indigo-600 text-white rounded-lg text-xs font-black hover:bg-indigo-700"><Copy size={14} /> {isCopied ? 'Copied!' : 'Confluence Copy'}</button>
                            <button onClick={copyReportAsImage} disabled={isImageCopying} className="flex items-center gap-1.5 px-4 py-2 bg-slate-900 text-white rounded-lg text-xs font-black hover:bg-slate-800"><Mail size={14} /> {isImageCopying ? '...' : 'Image Copy'}</button>
                        </div>
                    </header>

                    <main className="flex-1 p-6 max-w-[1700px] mx-auto w-full space-y-6">
                        <section className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-wrap items-end gap-6">
                            <div className="space-y-1.5">
                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-1.5"><Filter size={12} /> Date Range</label>
                                <div className="flex items-center gap-2">
                                    <input type="date" value={dateRange.start} onChange={e => setDateRange({...dateRange, start: e.target.value})} className="px-3 py-2 border border-slate-200 rounded-lg text-xs font-bold" />
                                    <span className="text-slate-300 font-bold">~</span>
                                    <input type="date" value={dateRange.end} onChange={e => setDateRange({...dateRange, end: e.target.value})} className="px-3 py-2 border border-slate-200 rounded-lg text-xs font-bold" />
                                </div>
                            </div>
                            <div className="space-y-1.5 min-w-[150px]">
                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-1.5"><Globe size={12} /> Market</label>
                                <select value={countryPicker} onChange={e => setCountryPicker(e.target.value)} className="w-full px-3 py-2 border border-slate-200 rounded-lg text-xs font-bold">
                                    <option value="All">All Markets</option><option value="TW">TW</option><option value="TH">TH</option><option value="JP">JP</option><option value="Global">Global</option>
                                </select>
                            </div>
                            <div className="space-y-1.5">
                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-1.5"><Smile size={12} /> Sentiment</label>
                                <div className="flex bg-slate-100 p-1 rounded-xl">
                                    {['All', 'Positive', 'Neutral', 'Negative'].map(s => (
                                        <button key={s} onClick={() => setSentimentPicker(s)} className={`px-5 py-1.5 text-[10px] font-black rounded-lg transition-all ${sentimentPicker === s ? 'bg-white shadow-sm text-slate-900' : 'text-slate-400'}`}>{s}</button>
                                    ))}
                                </div>
                            </div>
                            <button onClick={handleSearch} className="px-8 py-2.5 bg-slate-900 text-white rounded-xl text-xs font-black shadow-xl hover:bg-slate-800 ml-auto flex items-center gap-2"><Search size={16} /> Search</button>
                        </section>

                        <div ref={dashboardRef} className="p-4 rounded-3xl bg-slate-50 border border-slate-100 shadow-inner">
                            <h2 className="text-md font-black text-slate-800 flex items-center gap-2 uppercase tracking-tight mb-4 px-2"><LayoutGrid size={18} className="text-[#00B900]" /> Overview</h2>
                            <section className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-5 border-l-4 border-l-purple-500">
                                    <div className="flex items-center gap-2 mb-4"><PieChart size={18} className="text-purple-500" /><h3 className="font-black text-slate-800 text-[11px] uppercase">Insights</h3></div>
                                    <div className="space-y-4">
                                        <div className="bg-purple-50 p-3 rounded-lg"><span className="text-[10px] font-black text-purple-600 block mb-1">ENGLISH</span><p className="text-xs font-bold text-slate-700">"User satisfaction is stable, but CS response speed in TW needs improvement."</p></div>
                                        <div className="bg-purple-50 p-3 rounded-lg"><span className="text-[10px] font-black text-purple-600 block mb-1">KOREAN</span><p className="text-xs font-bold text-slate-700">"Ï†ÑÎ∞òÏ†ÅÏù∏ ÎßåÏ°±ÎèÑÎäî ÏïàÏ†ïÏ†ÅÏù¥ÎÇò, ÎåÄÎßå ÏßÄÏó≠Ïùò CS ÏùëÎãµ ÏÜçÎèÑ Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§."</p></div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-5 border-l-4 border-l-[#00B900]">
                                    <div className="flex items-center gap-2 mb-4"><BarChart2 size={18} className="text-[#00B900]" /><h3 className="font-black text-slate-800 text-[11px] uppercase">Metrics</h3></div>
                                    <div className="h-32 mb-2"><ResponsiveContainer width="100%" height="100%"><BarChart data={sentimentStats}><Bar dataKey="count"><Cell fill="#00B900"/><Cell fill="#94a3b8"/><Cell fill="#ef4444"/></Bar></BarChart></ResponsiveContainer></div>
                                    <div className="flex justify-between text-[10px] font-bold text-slate-500 px-2"><span>Pos: {sentimentStats[0].count}</span><span>Neu: {sentimentStats[1].count}</span><span>Neg: {sentimentStats[2].count}</span></div>
                                </div>
                                <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-5 border-l-4 border-l-blue-500">
                                    <div className="flex items-center gap-2 mb-4"><LayoutGrid size={18} className="text-blue-500" /><h3 className="font-black text-slate-800 text-[11px] uppercase">Categories</h3></div>
                                    <div className="space-y-2 overflow-y-auto max-h-[140px]">
                                        {categoryTableData.map(c => (
                                            <div key={c.name} className="flex justify-between text-[10px] font-bold border-b border-slate-50 pb-1"><span>{c.name}</span><span className="text-slate-900">{c.total}</span></div>
                                        ))}
                                    </div>
                                </div>
                            </section>
                        </div>

                        <section className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                            <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center"><h2 className="font-black text-slate-800 text-[11px] uppercase flex items-center gap-2"><MessageSquare size={16} className="text-[#00B900]" /> Feedbacks ({filteredData.length})</h2></div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm text-left table-fixed">
                                    <thead className="bg-slate-50 text-slate-500 font-black uppercase text-[9px] border-b border-slate-100">
                                        <tr><th className="px-6 py-3 w-[100px]">Source</th><th className="px-6 py-3 w-[90px]">Date</th><th className="px-6 py-3 w-[70px]">Loc</th><th className="px-6 py-3 w-[100px]">Sent</th><th className="px-6 py-3 w-[120px]">Cat</th><th className="px-6 py-3">Content</th><th className="px-6 py-3">Trans</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {paginatedData.map(item => (
                                            <tr key={item.id} className="hover:bg-slate-50 text-xs">
                                                <td className="px-6 py-3 font-bold">{item.source}</td>
                                                <td className="px-6 py-3 text-slate-400 font-bold">{item.date}</td>
                                                <td className="px-6 py-3 font-bold">{item.country}</td>
                                                <td className="px-6 py-3 font-bold text-slate-500">{item.sentiment}</td>
                                                <td className="px-6 py-3"><span className="bg-slate-100 px-2 py-1 rounded text-[10px] font-bold">{item.category}</span></td>
                                                <td className="px-6 py-3 font-bold text-slate-800 truncate">{item.originalContent}</td>
                                                <td className="px-6 py-3 text-slate-500 truncate">{item.koreanTranslation}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                             <div className="px-6 py-4 flex justify-center gap-2 border-t border-slate-100">
                                <button disabled={currentPage===1} onClick={()=>setCurrentPage(p=>p-1)} className="px-3 py-1 border rounded hover:bg-slate-50 disabled:opacity-50"><ChevronLeft size={14}/></button>
                                <span className="text-xs font-bold pt-1">Page {currentPage}</span>
                                <button disabled={currentPage===totalPages} onClick={()=>setCurrentPage(p=>p+1)} className="px-3 py-1 border rounded hover:bg-slate-50 disabled:opacity-50"><ChevronRight size={14}/></button>
                            </div>
                        </section>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
