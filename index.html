<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE Pay VOC Insights Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .bar-transition { transition: width 1s ease-out; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="h-16 bg-white border-b flex items-center justify-between px-6 shadow-sm sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 bg-[#00B900] rounded-xl flex items-center justify-center text-white text-lg shadow-lg">ğŸ“ˆ</div>
            <h1 class="font-black text-xl text-slate-900 tracking-tight">LINE PAY VOC INTELLIGENCE</h1>
        </div>
        <button onclick="downloadCSV()" class="px-4 py-2 bg-slate-900 text-white rounded-lg text-xs font-bold hover:bg-slate-700 transition">ğŸ“¥ Excel Download</button>
    </header>

    <main class="p-6 max-w-[1600px] mx-auto w-full space-y-6">
        
        <div class="bg-white p-5 rounded-2xl border shadow-sm flex flex-wrap gap-6 items-center">
            <div class="w-full md:w-auto">
                <label class="text-[10px] font-black text-slate-400 uppercase block mb-1">Target Market</label>
                <select id="countryFilter" onchange="renderApp()" class="w-full md:w-64 px-4 py-2 border rounded-xl text-sm font-bold focus:ring-2 focus:ring-green-500 outline-none bg-slate-50">
                    <option value="All">ğŸŒ Global Market</option>
                    <option value="TW">ğŸ‡¹ğŸ‡¼ Taiwan</option>
                    <option value="TH">ğŸ‡¹ğŸ‡­ Thailand</option>
                    <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
                </select>
            </div>
            <div class="ml-auto bg-green-50 px-4 py-2 rounded-xl text-green-700 text-xs font-bold border border-green-100 flex items-center gap-2">
                âœ… Total Feedbacks: <span id="totalCount">0</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="bg-white p-6 rounded-2xl border shadow-sm lg:col-span-1">
                <h3 class="font-black text-slate-800 text-sm uppercase mb-4">ğŸ“Š Sentiment Overview</h3>
                <div class="space-y-5">
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-1">
                            <span class="text-green-600">Positive ğŸ˜€</span>
                            <span id="posCount">0</span>
                        </div>
                        <div class="w-full bg-slate-100 rounded-full h-3">
                            <div id="posBar" class="bg-[#00B900] h-3 rounded-full bar-transition" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-1">
                            <span class="text-slate-500">Neutral ğŸ˜</span>
                            <span id="neuCount">0</span>
                        </div>
                        <div class="w-full bg-slate-100 rounded-full h-3">
                            <div id="neuBar" class="bg-slate-400 h-3 rounded-full bar-transition" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs font-bold mb-1">
                            <span class="text-red-500">Negative ğŸ˜¡</span>
                            <span id="negCount">0</span>
                        </div>
                        <div class="w-full bg-slate-100 rounded-full h-3">
                            <div id="negBar" class="bg-red-500 h-3 rounded-full bar-transition" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-8 rounded-2xl border shadow-sm lg:col-span-2 flex flex-col justify-center border-l-4 border-l-purple-500 bg-purple-50/10">
                <h3 class="font-black text-purple-600 text-sm uppercase mb-3">ğŸ¤– AI Strategic Insight</h3>
                <p id="insightText" class="text-slate-700 leading-relaxed text-sm font-medium">
                    Analyzing data...
                </p>
                <div class="mt-4 pt-4 border-t border-slate-200/50">
                    <p id="insightKo" class="text-slate-500 text-xs font-bold">
                        ë°ì´í„° ë¶„ì„ ì¤‘...
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl border shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-50 text-slate-500 font-black uppercase text-[10px] tracking-wider border-b">
                        <tr>
                            <th class="px-6 py-4">Source</th>
                            <th class="px-6 py-4">Date</th>
                            <th class="px-6 py-4">Country</th>
                            <th class="px-6 py-4">Sentiment</th>
                            <th class="px-6 py-4">Category</th>
                            <th class="px-6 py-4 w-1/3">Content</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-slate-50">
                        </tbody>
                </table>
            </div>
            <div class="p-4 border-t bg-slate-50/50 flex justify-center gap-3">
                <button id="prevBtn" onclick="changePage(-1)" class="px-4 py-2 bg-white border rounded-lg hover:bg-slate-50 disabled:opacity-50 font-bold text-xs shadow-sm">Prev</button>
                <span id="pageInfo" class="px-4 py-2 text-xs font-black text-slate-600 bg-white border rounded-lg shadow-sm flex items-center">Page 1</span>
                <button id="nextBtn" onclick="changePage(1)" class="px-4 py-2 bg-white border rounded-lg hover:bg-slate-50 disabled:opacity-50 font-bold text-xs shadow-sm">Next</button>
            </div>
        </div>
        
        <footer class="py-8 text-center text-slate-300 text-[10px] font-black uppercase tracking-widest">
            LINE Pay VOC Intelligence Dashboard Â© 2026
        </footer>
    </main>

    <script>
        // 1. ë°ì´í„° ìƒì„± (Mock Data)
        const MOCK_DATA = Array.from({ length: 150 }).map((_, i) => ({
            id: i,
            source: ['Facebook', 'App Store', 'Threads', 'Play Store'][i % 4],
            date: `2024-03-${((i % 28) + 1).toString().padStart(2, '0')}`,
            country: ['TW', 'TH', 'JP', 'Global'][i % 4],
            sentiment: ['Positive', 'Neutral', 'Negative'][Math.floor(Math.random() * 3)],
            category: ['Payment UX', 'Merchant Network', 'Promotion', 'Account Setup'][i % 4],
            content: `User feedback regarding LINE Pay service #${i+1}. The UI responsiveness and transaction speed were mentioned.`,
            translation: `LINE Pay ì„œë¹„ìŠ¤ í”¼ë“œë°± #${i+1}. UI ë°˜ì‘ ì†ë„ì™€ ê±°ë˜ ì†ë„ ê´€ë ¨ ë‚´ìš©ì…ë‹ˆë‹¤.`
        }));

        // ìƒíƒœ ë³€ìˆ˜
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentFilter = 'All';

        // 2. í™”ë©´ ê·¸ë¦¬ê¸° í•¨ìˆ˜ (Reactê°€ í•˜ë˜ ì¼ì„ ì–˜ê°€ ëŒ€ì‹  í•¨)
        function renderApp() {
            const filterVal = document.getElementById('countryFilter').value;
            currentFilter = filterVal;
            
            // í•„í„°ë§
            const filteredData = MOCK_DATA.filter(d => currentFilter === 'All' || d.country === currentFilter);
            
            // í†µê³„ ê³„ì‚°
            const posCount = filteredData.filter(d => d.sentiment === 'Positive').length;
            const neuCount = filteredData.filter(d => d.sentiment === 'Neutral').length;
            const negCount = filteredData.filter(d => d.sentiment === 'Negative').length;
            const total = filteredData.length;

            // ìƒë‹¨ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById('totalCount').innerText = total;

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (CSS width ì¡°ì ˆ)
            updateChart('pos', posCount, total);
            updateChart('neu', neuCount, total);
            updateChart('neg', negCount, total);

            // AI ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            const topSentiment = posCount >= negCount && posCount >= neuCount ? 'Positive' : (negCount > posCount ? 'Negative' : 'Neutral');
            const topColor = topSentiment === 'Positive' ? 'text-green-600' : (topSentiment === 'Negative' ? 'text-red-500' : 'text-slate-400');
            
            document.getElementById('insightText').innerHTML = 
                `Analysis of <strong>${total}</strong> feedbacks in <strong>${currentFilter === 'All' ? 'Global' : currentFilter}</strong> market indicates a predominantly <span class="${topColor} font-black">${topSentiment}</span> sentiment.`;
            
            document.getElementById('insightKo').innerText = 
                `ğŸ‡°ğŸ‡· (ìš”ì•½) ${currentFilter} ì‹œì¥ì˜ ${total}ê±´ ë°ì´í„°ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ì£¼ëœ ì—¬ë¡ ì€ '${topSentiment}'ì…ë‹ˆë‹¤.`;

            // í…Œì´ë¸” ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (í˜ì´ì§€ë„¤ì´ì…˜)
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredData.slice(start, end);
            const totalPages = Math.ceil(total / itemsPerPage);

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°

            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-slate-400 italic">No data found</td></tr>';
            } else {
                pageData.forEach(item => {
                    const sentimentColor = item.sentiment === 'Positive' ? 'text-green-600' : (item.sentiment === 'Negative' ? 'text-red-500' : 'text-slate-400');
                    const icon = item.sentiment === 'Positive' ? 'ğŸ˜€' : (item.sentiment === 'Negative' ? 'ğŸ˜¡' : 'ğŸ˜');
                    
                    const row = `
                        <tr class="hover:bg-slate-50/50 transition border-b border-slate-50 last:border-0">
                            <td class="px-6 py-4 font-bold text-slate-700">${item.source}</td>
                            <td class="px-6 py-4 text-slate-400 text-xs font-bold">${item.date}</td>
                            <td class="px-6 py-4"><span class="px-2 py-1 bg-slate-100 rounded text-[10px] font-black">${item.country}</span></td>
                            <td class="px-6 py-4"><span class="${sentimentColor} text-[10px] font-black flex items-center gap-1">${icon} ${item.sentiment.toUpperCase()}</span></td>
                            <td class="px-6 py-4"><span class="px-2 py-1 border rounded text-[10px] font-bold text-slate-500">${item.category}</span></td>
                            <td class="px-6 py-4">
                                <p class="text-slate-800 font-bold text-xs mb-1">"${item.content}"</p>
                                <p class="text-slate-400 text-[10px]">${item.translation}</p>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            }

            // í˜ì´ì§€ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('pageInfo').innerText = `Page ${currentPage} of ${totalPages || 1}`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
        }

        function updateChart(id, count, total) {
            const percentage = total === 0 ? 0 : Math.round((count / total) * 100);
            document.getElementById(`${id}Count`).innerText = `${count} (${percentage}%)`;
            document.getElementById(`${id}Bar`).style.width = `${percentage}%`;
        }

        function changePage(direction) {
            const total = MOCK_DATA.filter(d => currentFilter === 'All' || d.country === currentFilter).length;
            const totalPages = Math.ceil(total / itemsPerPage);
            const newPage = currentPage + direction;
            if (newPage > 0 && newPage <= totalPages) {
                currentPage = newPage;
                renderApp();
            }
        }

        // CSV ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ êµ¬í˜„)
        function downloadCSV() {
            const filteredData = MOCK_DATA.filter(d => currentFilter === 'All' || d.country === currentFilter);
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Source,Date,Country,Sentiment,Category,Content\n"; // í—¤ë”

            filteredData.forEach(row => {
                const cleanContent = row.content.replace(/,/g, " "); // ì‰¼í‘œ ì œê±°
                csvContent += `${row.source},${row.date},${row.country},${row.sentiment},${row.category},${cleanContent}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "line_pay_voc_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ì´ˆê¸° ì‹¤í–‰
        renderApp();
    </script>
</body>
</html>
